// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}



generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./hostel.db"
}

// --- 1. AUTHENTICATION (Single Admin) ---

model User {
  id        String   @id @default(uuid())
  username  String   @unique // e.g., "admin"
  password  String   // Hashed password
  name      String   // "Owner Name"
  role      String   @default("ADMIN")
  createdAt DateTime @default(now())
}

// --- 2. HIERARCHY (The Building) ---

model Property {
  id          String   @id @default(uuid())
  name        String   // "My PG Name"
  address     String?
  totalFloors Int      @default(1)
  
  rooms       Room[]
  createdAt   DateTime @default(now())
}

model Room {
  id          String   @id @default(uuid())
  roomNumber  String   // "101", "G-1"
  floorNumber Int      // For filtering: "Show Floor 1 Rooms"
  type        String   // "AC", "NON_AC"
  capacity    Int      // Total beds allowed
  
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id])
  
  beds        Bed[]
  complaints  Complaint[]
  
  // Ensure Room 101 doesn't exist twice in the same building
  @@unique([propertyId, roomNumber])
}

model Bed {
  id               String   @id @default(uuid())
  label            String   // "A", "B", "Window"
  
  // Status: "AVAILABLE", "OCCUPIED", "MAINTENANCE"
  // This drives the Red/Green color on Frontend
  status           String   @default("AVAILABLE") 
  
  roomId           String
  room             Room     @relation(fields: [roomId], references: [id])
  
  // Fast lookup: Who is sleeping here right now?
  currentStudentId String?  @unique
  currentStudent   Student? @relation(fields: [currentStudentId], references: [id])
}

// --- 3. RESIDENTS ---

model Student {
  id               String   @id @default(uuid())
  name             String
  age              Int
  phoneNumber      String   @unique
  email            String?
  emergencyContact String
  address          String?  // Home address
  
  isActive         Boolean  @default(true) // True = Currently living here
  
  // Link to Inventory
  assignedBed      Bed?
  
  // History
  bookings         Booking[]
  complaints       Complaint[] // Complaints raised by this student
  
  createdAt        DateTime @default(now())
}

// --- 4. BILLING & PAYMENTS ---

model Booking {
  id             String   @id @default(uuid())
  
  studentId      String
  student        Student  @relation(fields: [studentId], references: [id])
  
  // Duration Details
  frequency      String   // "MONTHLY", "YEARLY", "EXCEPTION"
  startDate      DateTime
  endDate        DateTime
  
  // Financials
  totalAmount    Float    // Final calculated amount
  
  // Link to the specific payment made during onboarding
  payment        Payment?
  
  createdAt      DateTime @default(now())
}

model Payment {
  id             String   @id @default(uuid())
  
  bookingId      String   @unique // 1-to-1: One booking has one initial payment
  booking        Booking  @relation(fields: [bookingId], references: [id])
  
  amount         Float
  date           DateTime @default(now())
  
  // STRICT 3 Modes
  method         String   // "UPI_REQUEST", "QR_SCAN", "CASH_OFFLINE"
  
  transactionRef String?  // Optional: UPI Ref ID or Note
}

// --- 5. COMPLAINTS (Room-Wise) ---

model Complaint {
  id          String   @id @default(uuid())
  
  category    String   // "PLUMBING", "ELECTRICAL", "CLEANING", "OTHER"
  description String
  
  status      String   @default("OPEN") // "OPEN", "RESOLVED" 
  
  // Linked specifically to a room
  roomId      String
  room        Room     @relation(fields: [roomId], references: [id])
  
  // Optional: Linked to student if known
  studentId   String?
  student     Student? @relation(fields: [studentId], references: [id])
  
  createdAt   DateTime @default(now())
  resolvedAt  DateTime?
}

//try4